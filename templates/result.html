<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LoanLens | Loan Recommendation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

<div class="container glass-heavy">

    

    <!-- HEADER -->
    <h2>Loan Recommendation Dashboard</h2>
    <p>
        Based on your financial profile and machine learning analysis,
        here are your most suitable loan options.
    </p>

    <!-- RISK -->
    <div class="risk {{ risk|lower }}">
        {{ risk }} Risk Profile
    </div>

    <!-- üèÜ FLOATING TOP LOANS -->
    {% if top_loans %}
    <div class="floating-loan-row">
        {% for loan in top_loans %}
        <div class="floating-loan-card">
            <div class="badge">BEST MATCH</div>

            <h3>üèÜ Recommended Loan</h3>

            <p><strong>Loan Type:</strong> {{ loan.loan_name }}</p>
            <p><strong>Bank:</strong> {{ loan.bank }}</p>
            <p><strong>Approval Probability:</strong> {{ loan.approval_probability * 100 }}%</p>
            <p><strong>Eligible Amount:</strong> ‚Çπ{{ loan.eligible_amount }}</p>

            <div class="recommendation
                {% if 'Recommended' in loan.recommendation %}recommended
                {% elif 'Risky' in loan.recommendation %}risky
                {% else %}not{% endif %}">
                {{ loan.recommendation }}
            </div>

            <p class="muted" style="margin-top:12px;">
                Why? {{ loan.reason }}
            </p>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- üìã TOP LOAN OPTIONS -->
    <div class="loan-card">
        <h3>Top Loan Suggestions</h3>

        {% if loans %}
        <table style="width:100%; margin-top:10px;">
            <tr>
                <th>#</th>
                <th>Loan</th>
                <th>Bank</th>
                <th>Amount</th>
                <th>Score</th>
                <th>Status</th>
            </tr>

            {% for loan in loans %}
            <tr {% if loop.index == 1 %}style="font-weight:bold;"{% endif %}>
                <td>{{ loop.index }}</td>
                <td>{{ loan.loan_name }}</td>
                <td>{{ loan.bank }}</td>
                <td>‚Çπ{{ loan.eligible_amount }}</td>
                <td>{{ loan.score }}%</td>
                <td>{{ loan.recommendation }}</td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
            <p>No loan options available.</p>
        {% endif %}
    </div>

    <!-- EXISTING LOAN -->
    <div class="loan-card">
        <h3>Existing Loan Status</h3>

        {% if pending_amount > 0 %}
            <p>üìå Pending Amount: ‚Çπ{{ pending_amount }}</p>
            <p>üìâ Pending Interest: ‚Çπ{{ existing_interest }}</p>
        {% else %}
            <p>‚úÖ No existing loan liabilities.</p>
        {% endif %}
    </div>

    <!-- INTEREST COMPARISON -->
    <div class="loan-card">
        <h3>Interest Comparison</h3>
        <ul>
            <li>Existing Interest: ‚Çπ{{ existing_interest }}</li>

            {% if using_refinance %}
            <li>Refinancing Interest: ‚Çπ{{ refinance_interest }}</li>
            {% else %}
            <li>New Loan Interest: ‚Çπ{{ new_interest }}</li>
            {% endif %}

            {% if savings_percent > 0 %}
            <li>üí∞ Potential Savings: {{ savings_percent }}%</li>
            {% else %}
            <li>‚ö† No interest savings identified</li>
            {% endif %}
        </ul>
        <!-- Interest chart -->
        <div style="margin-top:18px;">
            <canvas id="interestChart" width="800" height="260"></canvas>
        </div>
    </div>

    <!-- ADVISORY -->
    <div class="loan-card">
        <h3>Advisory Summary</h3>
        {% if reasons %}
        <ul class="advisory-list" style="margin-top:12px; line-height:1.6;">
            {% for r in reasons %}
            <li>{{ r }}</li>
            {% endfor %}
        </ul>
        {% else %}
        <p>{{ advisory }}</p>
        {% endif %}
    </div>

    <a href="{{ url_for('home') }}">‚Üê Start New Analysis</a>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const years = {{ interest_years|tojson }};
    const newSeries = {{ new_interest_series|tojson }};
    const existingSeries = {{ existing_interest_series|tojson }};

    const ctx = document.getElementById('interestChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: years.map(y => y + 'y'),
            datasets: [
                {
                    label: 'New Loan (cumulative interest)',
                    data: newSeries,
                    borderColor: '#00eaff',
                    backgroundColor: 'rgba(0,234,255,0.08)',
                    tension: 0.25,
                    fill: true
                },
                {
                    label: 'Existing Loan (cumulative interest)',
                    data: existingSeries,
                    borderColor: '#f43f5e',
                    backgroundColor: 'rgba(244,63,94,0.06)',
                    tension: 0.25,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
    

</body>
</html>
